<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Asistente AG Electrónica</title>
  <style>
    body { font-family: Arial, sans-serif; }
    .boton-opcion {
      background-color: #4A90E2;
      color: white;
      padding: 12px 20px;
      margin: 10px 5px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h2>Hola 👋, soy tu asistente virtual de <strong>AG Electrónica</strong></h2>
  <p>¿En qué te puedo ayudar? Selecciona una opción.</p>

  <button class="boton-opcion" onclick="opcionSeleccionada('Quiero asesoramiento')">🔍 Asesoramiento</button>
  <button class="boton-opcion" onclick="opcionSeleccionada('Quiero comprar')">🛒 Comprar</button>
  <button class="boton-opcion" onclick="opcionSeleccionada('Necesito soporte técnico')">🛠 Soporte Técnico</button>

  <div id="chat"></div>
  <div id="input-area">
    <input type="text" id="msg" placeholder="Escribe tu pregunta..." disabled />
    <button onclick="enviar()" disabled>Enviar</button>
  </div>

  <script>
    function opcionSeleccionada(texto) {
      const ultimaHora = localStorage.getItem('chat_last_used');
      const ahora = new Date().getTime();
      const inactivo = !ultimaHora || (ahora - parseInt(ultimaHora)) > 300000; // 5 minutos

      if (!localStorage.getItem('chat_session_id') || inactivo) {
        const nuevoID = 'cliente_' + Math.floor(Math.random() * 1000000);
        localStorage.setItem('chat_session_id', nuevoID);
        console.log("🆕 Nueva sesión iniciada:", nuevoID);
      } else {
        console.log("♻️ Continuando sesión:", localStorage.getItem('chat_session_id'));
      }

      localStorage.setItem('chat_last_used', ahora.toString());

      enviar(texto);
      document.getElementById('msg').disabled = false;
      document.querySelector('#input-area button').disabled = false;
    }

    function enviar(textoManual) {
      const texto = textoManual || document.getElementById('msg').value;
      const chat = document.getElementById('chat');
      const sessionId = localStorage.getItem('chat_session_id');

      const mensaje = document.createElement('p');
      mensaje.textContent = `🧑 Usuario (${sessionId}): ${texto}`;
      chat.appendChild(mensaje);

      document.getElementById('msg').value = '';

      // Aquí iría la llamada al backend con webhook
    }
  </script>
</body>
</html>
